<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="favicon.png">
    <title>VanityForge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <script type="module" src="utils/sns.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <meta property="og:description" content="Generate secure, custom Solana vanity addresses at 300 MH/s. 100% Zero-Custodial & PIN-Encrypted.">
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "VanityForge",
      "applicationCategory": "SecurityApplication",
      "operatingSystem": "Web",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "SOL"
      },
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "4.9",
        "ratingCount": "1250"
      },
      "featureList": "Zero-Custodial, 300 MH/s Speed, Encrypted Key Generation, Solana Vanity Address",
      "hasPart": {
        "@type": "HowTo",
        "name": "How to Generate a Vanity Address",
        "step": [
          {
            "@type": "HowToStep",
            "name": "Choose Prefix",
            "text": "Enter your desired prefix (e.g., ALICE) and suffix."
          },
          {
            "@type": "HowToStep",
            "name": "Pay Fee",
            "text": "Connect your wallet and pay the generation fee."
          },
          {
            "@type": "HowToStep",
            "name": "Download Encrypted Key",
            "text": "Once forged, reveal your private key using your secure PIN."
          }
        ]
      }
    }
    </script>
    <style>
        body { background-color: #1a1a1a; color: #e0e0e0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding-top: 120px; }
        .glass-panel { background: rgba(40, 40, 40, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }

        /* Stats Bar Animation */
        @keyframes spin { to { transform: rotate(360deg); } }
        .gear-spin { animation: spin 12s linear infinite; }
        .gear-fast { animation-duration: 0.8s !important; }

        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1a1a1a; }
        ::-webkit-scrollbar-thumb { background: #4a4a4a; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #6a6a6a; }
        .numpad-btn {
            @apply bg-gray-800 hover:bg-gray-700 text-white font-bold py-4 rounded-lg shadow transition transform active:scale-95 text-xl;
        }
        .pin-dot {
            width: 12px; height: 12px; border-radius: 50%; background-color: #4b5563; transition: all 0.2s;
        }
        .pin-dot.active {
            background-color: #9333ea; box-shadow: 0 0 8px #9333ea;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center px-4">

    <nav class="fixed top-0 left-0 w-full z-50 glass-panel border-b border-gray-700/50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <span class="text-purple-500 font-bold text-xl tracking-wider uppercase"><i class="fa-solid fa-fire-flame-curved"></i> VanityForge</span>
                    </div>
                    <div class="hidden md:block">
                        <div class="ml-10 flex items-baseline space-x-4">
                            <a href="#" onclick="showSection('forge'); return false;" class="text-white bg-gray-900 px-3 py-2 rounded-md text-sm font-medium transition-colors" id="nav-forge">Forge</a>
                            <a href="#" onclick="openReferralDashboard(); return false;" class="text-gray-300 hover:text-white hover:bg-gray-700 px-3 py-2 rounded-md text-sm font-medium transition-colors" id="nav-referrals">Referrals</a>
                            <a href="/vvvip" class="text-gray-300 hover:text-white hover:bg-gray-700 px-3 py-2 rounded-md text-sm font-medium transition-colors">VVVIP Addresses</a>
                            <a href="#" onclick="openSecurityModal(); return false;" class="text-gray-300 hover:text-white hover:bg-gray-700 px-3 py-2 rounded-md text-sm font-medium transition-colors"><i class="fa-solid fa-shield-halved"></i> Security</a>
                            <a href="/roadmap" class="text-gray-300 hover:text-white hover:bg-gray-700 px-3 py-2 rounded-md text-sm font-medium transition-colors">Roadmap</a>
                            <a href="/faq" class="text-gray-300 hover:text-white hover:bg-gray-700 px-3 py-2 rounded-md text-sm font-medium transition-colors">FAQ</a>
                            <a href="https://x.com/vanityforgeX" target="_blank" class="text-gray-300 hover:text-white hover:bg-gray-700 px-3 py-2 rounded-md text-sm font-medium transition-colors"><i class="fa-brands fa-x-twitter"></i></a>
                            <a href="https://github.com/TomaAytakin/VanityForge" target="_blank" class="text-gray-300 hover:text-white hover:bg-gray-700 px-3 py-2 rounded-md text-sm font-medium transition-colors"><i class="fa-brands fa-github"></i> GitHub</a>
                        </div>
                    </div>
                </div>
                <div class="-mr-2 flex md:hidden">
                    <button type="button" onclick="document.getElementById('mobile-menu').classList.toggle('hidden')" class="bg-gray-800 inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-white hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-white">
                        <span class="sr-only">Open main menu</span>
                        <i class="fa-solid fa-bars"></i>
                    </button>
                </div>
            </div>
        </div>

        <div class="hidden md:hidden" id="mobile-menu">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="#" onclick="showSection('forge'); return false;" class="text-white bg-gray-900 block px-3 py-2 rounded-md text-base font-medium">Forge</a>
                <a href="#" onclick="openReferralDashboard(); return false;" class="text-gray-300 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Referrals</a>
                <a href="/vvvip" class="text-gray-300 hover:text-white block px-3 py-2 rounded-md text-base font-medium">VVVIP Addresses</a>
                <a href="#" onclick="openSecurityModal(); return false;" class="text-gray-300 hover:text-white block px-3 py-2 rounded-md text-base font-medium"><i class="fa-solid fa-shield-halved"></i> Security</a>
                <a href="/roadmap" class="text-gray-300 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Roadmap</a>
                <a href="/faq" class="text-gray-300 hover:text-white block px-3 py-2 rounded-md text-base font-medium">FAQ</a>
                <a href="https://x.com/vanityforgeX" target="_blank" class="text-gray-300 hover:text-white block px-3 py-2 rounded-md text-base font-medium"><i class="fa-brands fa-x-twitter"></i> X (Twitter)</a>
                <a href="https://github.com/TomaAytakin/VanityForge" target="_blank" class="text-gray-300 hover:text-white block px-3 py-2 rounded-md text-base font-medium">GitHub</a>
            </div>
        </div>
    </nav>

    <!-- Stats Bar -->
    <div class="fixed top-16 left-0 w-full bg-gray-900/80 backdrop-blur border-b border-gray-700 py-2 flex justify-center items-center gap-3 text-purple-300 font-mono text-sm tracking-widest uppercase shadow-md z-40">
        <i id="activity-gear" class="fa-solid fa-gear gear-spin text-purple-500"></i>
        <span>Vanity Identities Forged: <span id="identity-counter" class="text-white font-bold text-base">...</span></span>
    </div>

    <div class="w-full max-w-2xl mb-8 flex flex-col items-center justify-center mt-10 gap-4">
        <div class="bg-gradient-to-r from-green-500 to-emerald-500 text-white font-bold py-2 px-6 rounded-full shadow-lg border border-green-400 flex items-center gap-2 animate-pulse">
            <i class="fa-brands fa-nvidia"></i> ⚡ 300 MH/S CLUSTER: The Fastest Custom Solana Key Generator
        </div>
        <img src="animated_forge.gif" alt="VanityForge Banner" class="rounded-xl shadow-2xl border border-gray-700 max-w-full h-auto">
    </div>

    <div id="auth-section" class="w-full max-w-2xl glass-panel p-8 rounded-xl shadow-lg text-center transition-all duration-300">
        <h2 class="text-2xl font-bold mb-6 text-purple-400">Connect to VanityForge</h2>
        <div class="flex flex-col gap-4 max-w-xs mx-auto">
            <button onclick="loginWithGoogle()" class="bg-white hover:bg-gray-100 text-gray-800 font-bold py-3 px-6 rounded-lg transition duration-200 flex items-center justify-center gap-2 shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                <i class="fa-brands fa-google"></i> Login with Google
            </button>
            <button id="connect-phantom-btn" onclick="connectWallet()" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg transition duration-200 flex items-center justify-center gap-2 shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                <i class="fa-solid fa-wallet"></i> Connect Phantom
            </button>
        </div>
    </div>

    <div id="app-interface" class="w-full max-w-2xl hidden space-y-6 animate-fade-in-up">

        <!-- ADMIN DASHBOARD SECTION -->
        <div id="admin-dashboard" class="glass-panel p-8 rounded-xl shadow-lg hidden">
            <h2 class="text-xl font-bold mb-6 text-yellow-400 flex items-center gap-2 border-b border-gray-700 pb-2">
                <i class="fa-solid fa-bolt"></i> God Mode Dashboard
            </h2>

            <div class="flex space-x-4 mb-6">
                <button onclick="showAdminTab('financials')" class="text-white bg-gray-700 px-3 py-2 rounded-md text-sm font-bold">Financials</button>
                <button onclick="showAdminTab('security')" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-bold">Security</button>
                <button onclick="showAdminTab('referrals-admin')" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-bold">Referrals</button>
            </div>

            <div id="admin-financials">
                <div class="grid grid-cols-3 gap-4 mb-4">
                    <div class="bg-gray-800 p-4 rounded text-center">
                        <span class="block text-gray-500 text-xs uppercase">Income (1W)</span>
                        <span class="text-2xl font-bold text-green-400" id="admin-inc-1w">...</span>
                    </div>
                    <div class="bg-gray-800 p-4 rounded text-center">
                        <span class="block text-gray-500 text-xs uppercase">Income (1M)</span>
                        <span class="text-2xl font-bold text-green-400" id="admin-inc-1m">...</span>
                    </div>
                    <div class="bg-gray-800 p-4 rounded text-center">
                        <span class="block text-gray-500 text-xs uppercase">Total Users</span>
                        <span class="text-2xl font-bold text-blue-400" id="admin-users">...</span>
                    </div>
                </div>
            </div>

            <div id="admin-security" class="hidden">
                 <h3 class="text-sm font-bold text-gray-400 mb-2">Recent Security Events</h3>
                 <div id="admin-sec-logs" class="bg-black/30 p-2 rounded h-40 overflow-y-auto font-mono text-xs text-red-300">
                     Loading...
                 </div>
            </div>

            <div id="admin-referrals-admin" class="hidden">
                 <h3 class="text-sm font-bold text-gray-400 mb-2">Top Referrers</h3>
                 <div id="admin-ref-list" class="space-y-2">
                     Loading...
                 </div>
            </div>
        </div>

        <!-- REFERRAL DASHBOARD SECTION -->
        <div id="referral-dashboard" class="glass-panel p-8 rounded-xl shadow-lg hidden">
            <h2 class="text-xl font-bold mb-6 text-purple-400 flex items-center gap-2 border-b border-gray-700 pb-2">
                <i class="fa-solid fa-users"></i> Referral Program
            </h2>

            <div id="referral-loading" class="text-center py-8 text-gray-400">
                <i class="fa-solid fa-spinner fa-spin text-2xl"></i><br>Loading Stats...
            </div>

            <!-- STATE 1: CREATE CODE -->
            <div id="referral-create" class="hidden text-center py-4">
                <i class="fa-solid fa-gift text-4xl text-purple-500 mb-4"></i>
                <h3 class="text-lg font-bold text-white mb-2">Earn 15% Commission Forever</h3>
                <p class="text-gray-400 text-sm mb-6 max-w-sm mx-auto">
                    Create your unique referral code. When users pay with your code, they get a <span class="text-green-400">10% Discount</span> and are
                    <span class="text-purple-400 font-bold">Lifetime Bound</span> to you. You earn 15% on every job they ever submit.
                </p>
                <button onclick="openNumpad('create_referral', 'Enter PIN to Generate Code', createReferralCode)" class="bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white font-bold py-3 px-8 rounded-lg shadow-lg transition transform hover:scale-105">
                    Generate My Code
                </button>
            </div>

            <!-- STATE 2: STATS & WITHDRAW -->
            <div id="referral-stats" class="hidden">
                <div class="bg-gray-800/50 rounded-lg p-6 mb-6 border border-gray-700">
                    <div class="flex flex-col md:flex-row justify-between items-center gap-4 mb-4">
                        <div class="text-center md:text-left">
                             <span class="text-xs text-gray-500 uppercase font-bold tracking-wider">Your Referral Code</span>
                             <div class="text-4xl font-mono font-bold text-white tracking-widest mt-1 text-purple-400" id="my-ref-code">----</div>
                        </div>
                        <div class="flex gap-3">
                             <button onclick="copyReferralCode()" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded shadow flex items-center gap-2 transition transform active:scale-95">
                                 <i class="fa-regular fa-copy"></i> Copy Code
                             </button>
                             <button onclick="copyReferralLink()" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded shadow flex items-center gap-2 transition transform active:scale-95">
                                 <i class="fa-solid fa-link"></i> Copy Link
                             </button>
                        </div>
                    </div>
                    <div class="pt-4 border-t border-gray-700 flex justify-between items-center text-sm">
                        <span class="text-gray-400">Total Usage:</span>
                        <strong class="text-white text-lg" id="ref-usage">0</strong>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="bg-gray-800/50 p-4 rounded-lg border border-gray-700 text-center">
                        <span class="text-xs text-gray-500 uppercase block mb-1">Total Earnings</span>
                        <span class="text-xl font-bold text-green-400" id="ref-total">0.00 SOL</span>
                    </div>
                    <div class="bg-gray-800/50 p-4 rounded-lg border border-gray-700 text-center">
                         <span class="text-xs text-gray-500 uppercase block mb-1">Available Balance</span>
                         <span class="text-xl font-bold text-purple-400" id="ref-balance">0.00 SOL</span>
                    </div>
                </div>

                <h3 class="text-sm font-bold text-gray-300 mb-3 border-t border-gray-700 pt-4">Request Withdrawal</h3>
                <div class="space-y-3">
                    <input type="number" id="withdraw-amount" class="w-full bg-gray-800 border border-gray-700 rounded p-2 text-white text-sm" placeholder="Amount (Min 0.1 SOL)">
                    <input type="text" id="withdraw-wallet" class="w-full bg-gray-800 border border-gray-700 rounded p-2 text-white text-sm font-mono" placeholder="Target Wallet Address">
                    <button onclick="initiateWithdrawal()" class="w-full bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 rounded transition border border-gray-600">
                        Request Payout
                    </button>
                    <p class="text-[10px] text-gray-500 text-center">Withdrawals are processed manually within 24 hours.</p>
                </div>
            </div>
        </div>

        <div id="forge-section">
        <div class="glass-panel p-8 rounded-xl shadow-lg relative overflow-hidden">
            <div class="absolute top-0 right-0 p-4 opacity-10">
                <i class="fa-solid fa-code text-6xl text-purple-500"></i>
            </div>
            <h2 class="text-xl font-bold mb-4 text-purple-400 flex items-center gap-2">
                <i class="fa-solid fa-plus-circle"></i> Request New Vanity Address
            </h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-1">Prefix (Starts with)</label>
                    <input type="text" id="prefix" class="w-full bg-gray-800 border border-gray-700 rounded p-3 focus:border-purple-500 focus:outline-none text-white font-mono placeholder-gray-600" placeholder="e.g. CAFE">
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-1">Suffix (Ends with)</label>
                    <input type="text" id="suffix" class="w-full bg-gray-800 border border-gray-700 rounded p-3 focus:border-purple-500 focus:outline-none text-white font-mono placeholder-gray-600" placeholder="e.g. 888">
                </div>
            </div>

            <!-- Referral Code Input -->
            <div class="mb-4">
                 <label class="block text-sm text-gray-400 mb-1">Referral Code (Optional)</label>
                 <div class="flex gap-2">
                     <input type="text" id="referral-code-input" maxlength="4" class="w-full bg-gray-800 border border-gray-700 rounded p-2 focus:border-purple-500 focus:outline-none text-white font-mono placeholder-gray-600 uppercase" placeholder="CODE">
                     <button onclick="checkReferralCode()" class="bg-gray-700 hover:bg-gray-600 text-white px-4 rounded border border-gray-600 transition" type="button">
                         Check
                     </button>
                 </div>
                 <p id="referral-status-msg" class="text-xs mt-1 hidden"></p>
            </div>

            <p class="text-xs text-gray-500 mb-4">Note: Characters 0, O, I, and l are not allowed by Solana for security reasons.</p>

            <div class="flex flex-col gap-3 mb-4">
                <div class="flex items-center gap-2">
                    <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                        <input type="checkbox" name="toggle" id="case-sensitive" class="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                        <label for="case-sensitive" class="toggle-label block overflow-hidden h-5 rounded-full bg-gray-700 cursor-pointer"></label>
                    </div>
                    <label for="case-sensitive" class="text-sm text-gray-300 cursor-pointer select-none">Case Sensitive</label>

                    <div class="ml-auto flex items-center gap-2">
                        <input type="checkbox" id="email-notify" class="w-4 h-4 text-purple-600 bg-gray-700 border-gray-600 rounded focus:ring-purple-500 focus:ring-2">
                        <label for="email-notify" class="text-sm text-gray-300 cursor-pointer select-none">Email me when done</label>
                    </div>
                </div>

                <div class="mb-4">
                  <label class="block text-gray-400 text-sm font-bold mb-2">Compute Method</label>
                  <div class="flex space-x-4">
                    <label class="inline-flex items-center">
                      <input type="radio" name="compute_method" value="cpu" checked class="form-radio text-purple-500">
                      <span class="ml-2 text-white">CPU (Stable)</span>
                    </label>
                    <label class="inline-flex items-center">
                      <input type="radio" name="compute_method" value="gpu" class="form-radio text-purple-500">
                      <span class="ml-2 text-white">GPU (Updating...)</span>
                    </label>
                  </div>
                  <div id="gpu-warning" class="hidden mt-2 p-2 bg-yellow-600 text-white rounded text-sm">
                    ⚠️ GPU Worker Cluster is currently updating. Please use CPU.
                  </div>
                </div>

                <!-- GPU Option Removed: Now Default -->
                <div class="hidden flex items-center gap-2 p-2 bg-purple-900/20 rounded border border-purple-500/30">
                     <input type="checkbox" id="use-gpu" class="w-4 h-4 text-purple-600 bg-gray-700 border-gray-600 rounded focus:ring-purple-500 focus:ring-2" checked disabled>
                </div>
            </div>

                <style>
                    .toggle-checkbox:checked { right: 0; border-color: #9333ea; }
                    .toggle-checkbox:checked + .toggle-label { background-color: #9333ea; }
                    .toggle-checkbox { right: 0; border-color: #4b5563; transition: all 0.3s; top: 0; left: 0;}
                    .toggle-checkbox:checked { left: 50%; }
                    .toggle-label { width: 100%; }
                    .toggle-checkbox { position: absolute; top:0; left: 0; right: auto; bottom: auto; }
                    .toggle-checkbox:checked { left: 1.25rem; border-color: #a855f7; }
                </style>
            </div>

            <div class="bg-gray-800/50 rounded-lg p-4 mb-6 text-sm border border-gray-700">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-gray-400">Difficulty:</span>
                    <span id="calc-difficulty" class="text-white font-bold">0 chars</span>
                </div>
                <div class="flex justify-between items-center mb-2">
                    <span class="text-gray-400">Est. Time:</span>
                    <span id="calc-time" class="text-white font-mono">Instant</span>
                </div>
                <div class="flex justify-between items-center pt-2 border-t border-gray-700">
                    <span class="text-gray-400">Cost:</span>
                    <span id="calc-cost" class="text-green-400 font-bold font-mono">0 Credits</span>
                </div>

                <table class="w-full mt-4 border-t border-gray-700 pt-2 text-xs">
                    <thead>
                        <tr class="text-gray-500 uppercase tracking-wider">
                            <th class="text-left pb-1">Length</th>
                            <th class="text-right pb-1">Time (300 MH/s)</th>
                        </tr>
                    </thead>
                    <tbody class="text-gray-300 font-mono">
                        <tr>
                            <td>4 Chars</td>
                            <td class="text-right text-green-400">Instant</td>
                        </tr>
                        <tr>
                            <td>5 Chars</td>
                            <td class="text-right text-green-400">~1 Sec</td>
                        </tr>
                        <tr>
                            <td>6 Chars</td>
                            <td class="text-right text-yellow-400">~1 Min</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <button onclick="startSubmissionFlow()" class="w-full bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white font-bold py-4 rounded-lg shadow-lg transition transform hover:scale-[1.01] active:scale-[0.99] flex justify-center items-center gap-2">
                <i class="fa-solid fa-rocket"></i> Forge
            </button>
            <p id="submit-error" class="text-red-400 text-sm mt-3 text-center hidden bg-red-900/20 py-2 rounded border border-red-900/50"></p>
        </div> <!-- End of forge-section -->

        <!-- Job Queue Section -->
        <div id="job-queue-section" class="glass-panel p-8 rounded-xl shadow-lg hidden">
            <h3 class="text-lg font-bold mb-4 text-gray-300 border-b border-gray-700 pb-2 flex items-center justify-between">
                <span><i class="fa-solid fa-list-ul mr-2 text-purple-500"></i>Your Jobs</span>
                <div class="flex items-center gap-3">
                    <span class="text-xs font-normal text-gray-500" id="user-id-display"></span>
                    <button onclick="logout()" class="text-xs text-red-400 hover:text-red-300 transition-colors" title="Logout">
                        <i class="fa-solid fa-sign-out-alt"></i>
                    </button>
                </div>
            </h3>
            <div class="overflow-x-auto">
                <!-- Job Queue Table: Fixed Layout -->
                <table class="w-full text-left border-collapse" style="table-layout: fixed;">
                    <thead>
                        <tr class="text-gray-400 border-b border-gray-700 text-xs uppercase tracking-wider">
                             <!-- Fixed Column Widths -->
                             <th class="py-3 font-medium text-gray-500" style="width: 25%;">Target</th>
                             <th class="py-3 font-medium text-gray-500" style="width: 20%;">Status</th>
                             <th class="py-3 font-medium text-gray-500" style="width: 55%;">Details / Key</th>
                        </tr>
                    </thead>
                    <tbody id="jobs-container" class="text-sm divide-y divide-gray-800">
                        <!-- Rows injected here -->
                    </tbody>
                </table>
                <div id="jobs-empty-state" class="text-center text-gray-500 italic py-8 hidden">No active jobs found.</div>
            </div>
        </div>
    </div>

    <div id="numpad-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-80 backdrop-blur-sm hidden transition-opacity duration-300">
        <div class="bg-gray-900 border border-gray-700 rounded-2xl shadow-2xl p-6 w-full max-w-sm transform scale-95 transition-transform duration-300" id="numpad-content">
            <h3 id="numpad-title" class="text-center text-xl font-bold text-white mb-6">Enter Vault PIN</h3>

            <div id="numpad-warning" class="hidden bg-yellow-900/30 border border-yellow-600/50 text-yellow-200 p-3 rounded mb-4 text-xs text-left">
                <p class="font-bold mb-1"><i class="fa-solid fa-triangle-exclamation mr-1"></i> Warning:</p>
                You are about to create a permanent encryption PIN. VanityForge does not store this PIN. If you lose it, you will permanently lose the capability to reveal your private keys or forge new wallets within your VanityForge account. We cannot recover it for you.
            </div>

            <div class="flex justify-center gap-4 mb-8" id="pin-display">
                </div>

            <div id="numpad-checkbox-container" class="hidden mb-4 text-left">
                 <label class="flex items-start gap-2 text-xs text-gray-400 cursor-pointer">
                    <input type="checkbox" id="pin-acknowledge" class="mt-0.5 w-4 h-4 text-purple-600 bg-gray-700 border-gray-600 rounded focus:ring-purple-500 focus:ring-2">
                    <span>I acknowledge that VanityForge cannot recover my PIN if lost, and that losing my PIN means I will be unable to reveal my private keys or access my VanityForge account functions.</span>
                </label>
            </div>

            <div class="grid grid-cols-3 gap-4">
                <button class="numpad-btn bg-gray-800 hover:bg-gray-700 text-white font-bold py-4 rounded-lg shadow transition transform active:scale-95 text-xl" onclick="numpadInput(1)">1</button>
                <button class="numpad-btn bg-gray-800 hover:bg-gray-700 text-white font-bold py-4 rounded-lg shadow transition transform active:scale-95 text-xl" onclick="numpadInput(2)">2</button>
                <button class="numpad-btn bg-gray-800 hover:bg-gray-700 text-white font-bold py-4 rounded-lg shadow transition transform active:scale-95 text-xl" onclick="numpadInput(3)">3</button>
                <button class="numpad-btn bg-gray-800 hover:bg-gray-700 text-white font-bold py-4 rounded-lg shadow transition transform active:scale-95 text-xl" onclick="numpadInput(4)">4</button>
                <button class="numpad-btn bg-gray-800 hover:bg-gray-700 text-white font-bold py-4 rounded-lg shadow transition transform active:scale-95 text-xl" onclick="numpadInput(5)">5</button>
                <button class="numpad-btn bg-gray-800 hover:bg-gray-700 text-white font-bold py-4 rounded-lg shadow transition transform active:scale-95 text-xl" onclick="numpadInput(6)">6</button>
                <button class="numpad-btn bg-gray-800 hover:bg-gray-700 text-white font-bold py-4 rounded-lg shadow transition transform active:scale-95 text-xl" onclick="numpadInput(7)">7</button>
                <button class="numpad-btn bg-gray-800 hover:bg-gray-700 text-white font-bold py-4 rounded-lg shadow transition transform active:scale-95 text-xl" onclick="numpadInput(8)">8</button>
                <button class="numpad-btn bg-gray-800 hover:bg-gray-700 text-white font-bold py-4 rounded-lg shadow transition transform active:scale-95 text-xl" onclick="numpadInput(9)">9</button>
                <button class="numpad-btn bg-gray-800 hover:bg-gray-700 text-red-400 font-bold py-4 rounded-lg shadow transition transform active:scale-95 text-xl" onclick="numpadClear()"><i class="fa-solid fa-delete-left"></i></button>
                <button class="numpad-btn bg-gray-800 hover:bg-gray-700 text-white font-bold py-4 rounded-lg shadow transition transform active:scale-95 text-xl" onclick="numpadInput(0)">0</button>
                <button id="numpad-submit-btn" class="numpad-btn bg-purple-600 hover:bg-purple-700 text-white font-bold py-4 rounded-lg shadow transition transform active:scale-95 text-xl" onclick="numpadSubmit()"><i class="fa-solid fa-check"></i></button>
            </div>
            <button onclick="closeNumpad()" class="mt-6 w-full text-gray-500 hover:text-white text-sm">Cancel</button>
        </div>
    </div>

    <div id="beta-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-80 backdrop-blur-sm hidden transition-opacity duration-300">
        <div class="bg-gray-900 border border-purple-500 rounded-2xl shadow-2xl p-6 w-full max-w-sm transform scale-95 transition-transform duration-300 text-center relative overflow-hidden" id="beta-modal-content">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-purple-500 to-pink-500"></div>
            <i class="fa-solid fa-tags text-4xl text-purple-400 mb-4 animate-bounce"></i>
            <h3 class="text-2xl font-bold text-white mb-2">Beta Access Unlocked!</h3>
            <p class="text-gray-300 mb-6">You've received a <span class="text-purple-400 font-bold">50% Discount</span> on all vanity address generations during our Beta phase.</p>
            <button onclick="closeBetaModal()" class="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-bold py-2 px-6 rounded-lg shadow-lg transition transform hover:scale-105">
                Let's Forge!
            </button>
        </div>
    </div>

    <div id="security-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-80 backdrop-blur-sm hidden transition-opacity duration-300">
        <div class="bg-gray-900 border border-green-500 rounded-2xl shadow-2xl p-6 w-full max-w-2xl transform scale-95 transition-transform duration-300 relative overflow-hidden max-h-[90vh] overflow-y-auto" id="security-modal-content">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-green-500 to-blue-500"></div>

            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-white flex items-center gap-2">
                    <i class="fa-solid fa-shield-halved text-green-400"></i> Zero-Custodial Security
                </h3>
                <button onclick="closeSecurityModal()" class="text-gray-400 hover:text-white">
                    <i class="fa-solid fa-times text-xl"></i>
                </button>
            </div>

            <div class="space-y-6 text-gray-300">
                <div class="bg-gray-800/50 p-4 rounded-lg border border-gray-700">
                    <h4 class="text-green-400 font-bold mb-2"><i class="fa-solid fa-microchip"></i> Ephemeral RAM Processing</h4>
                    <p class="text-sm">
                        VanityForge utilizes a stateless architecture. Private keys are generated in volatile RAM within secure, isolated containers.
                        Once the vanity address is found, it is immediately encrypted. The raw private key
                        <span class="text-white font-bold">never touches a hard drive or database</span> in its unencrypted form.
                    </p>
                </div>

                <div class="bg-gray-800/50 p-4 rounded-lg border border-gray-700">
                    <h4 class="text-green-400 font-bold mb-2"><i class="fa-solid fa-lock"></i> Client-Side PIN Encryption</h4>
                    <p class="text-sm">
                        Before your key leaves the generation container, it is encrypted using
                        <span class="font-mono text-xs bg-black/30 p-1 rounded">Fernet (AES-128-CBC)</span> with a key derived from your
                        <span class="text-white font-bold">Personal Vault PIN</span> using
                        <span class="font-mono text-xs bg-black/30 p-1 rounded">PBKDF2-HMAC-SHA256</span> (100,000 iterations).
                        We do not store your PIN. Without it, the stored encrypted blob is mathematically impossible to decrypt.
                    </p>
                </div>

                <div class="bg-gray-800/50 p-4 rounded-lg border border-gray-700">
                    <h4 class="text-green-400 font-bold mb-2"><i class="fa-solid fa-eye-slash"></i> Radical Transparency</h4>
                    <p class="text-sm">
                        Our codebase is open source. The entire generation pipeline, from the Numpad UI to the Rust-based GPU grinder, is verifiable on GitHub.
                        You verify the code, you trust the math.
                    </p>
                </div>
            </div>

            <button onclick="closeSecurityModal()" class="mt-6 w-full bg-gray-800 hover:bg-gray-700 text-white font-bold py-3 rounded-lg border border-gray-600 transition">
                Close Security Brief
            </button>
        </div>
    </div>

    <script>
        // CONFIGURATION (HARDCODED)
        const TREASURY_WALLET_ADDRESS = "CUfjsGUee8u83dfFxHt1jXJUCRLiF1KoWVYcKyVforGe";
        const API_URL = "/submit-job"; // Relative path
        const FIREBASE_CONFIG = {
            apiKey: "AIzaSyCSYhscdfpQD19GMsm3qIJw9AWC5OYjqMY",
            authDomain: "vanityforge.firebaseapp.com",
            projectId: "vanityforge",
            storageBucket: "vanityforge.firebasestorage.app",
            messagingSenderId: "124272129554",
            appId: "1:124272129554:web:5e4f9e1d89bd54b3accacb",
            measurementId: "G-97FJY9VP2K"
        };
        // INIT FIREBASE
        if (!firebase.apps.length) {
            firebase.initializeApp(FIREBASE_CONFIG);
        }
        const db = firebase.firestore();
        // CHECK REDIRECT RESULT
        firebase.auth().getRedirectResult().then(async (result) => {
            if (result.user) {
                const user = result.user;
                const token = await user.getIdToken();
                currentUser = user.uid;
                currentUserEmail = user.email;
                checkUserStatus(currentUser, token);
            }
        }).catch((error) => {
            console.error("Redirect Login Error:", error);
            // Optional: alert(error.message);
        });
        // STATE
        const ADMIN_EMAILS = ["tomaaytakin@gmail.com", "Jonny95hidalgo@gmail.com", "admin@vanityforge.org"];
        let isExplicitLogin = false;
        var currentUser = null;
        var currentUserEmail = null;
        var jobListenerUnsubscribe = null;
        var userTrialsUsed = 0;
        var referralDiscountActive = false;

        // AUDIO SYSTEM
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            if (type === 'input') {
                // High pitch blip
                oscillator.type = 'sine';
                // or triangle
                oscillator.frequency.setValueAtTime(880, audioCtx.currentTime);
                // A5
                oscillator.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);

                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.1);
            } else if (type === 'delete') {
                // Low pitch whoosh/buzz
                oscillator.type = 'sawtooth';
                oscillator.frequency.setValueAtTime(150, audioCtx.currentTime);
                oscillator.frequency.linearRampToValueAtTime(50, audioCtx.currentTime + 0.2);

                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);

                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.2);
            }
        }

        // NUMPAD LOGIC
        let currentPin = "";
        let numpadMode = ""; // 'create', 'submit', 'reveal'
        let numpadCallback = null;
        let revealJobId = null;

        function openNumpad(mode, title, callback, jobId = null) {
            currentPin = "";
            numpadMode = mode;
            numpadCallback = callback;
            revealJobId = jobId;

            document.getElementById('numpad-title').innerText = title;
            updatePinDisplay();

            const warningEl = document.getElementById('numpad-warning');
            const checkboxContainer = document.getElementById('numpad-checkbox-container');
            const checkbox = document.getElementById('pin-acknowledge');
            const submitBtn = document.getElementById('numpad-submit-btn');

            if (mode === 'create') {
                warningEl.classList.remove('hidden');
                checkboxContainer.classList.remove('hidden');
                checkbox.checked = false;
                updateSubmitButtonState();
            } else {
                warningEl.classList.add('hidden');
                checkboxContainer.classList.add('hidden');
                submitBtn.disabled = false;
                submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                submitBtn.classList.add('hover:bg-purple-700', 'active:scale-95');
            }

            const modal = document.getElementById('numpad-modal');
            modal.classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('numpad-content').classList.replace('scale-95', 'scale-100');
            }, 10);
        }

        document.getElementById('pin-acknowledge').addEventListener('change', updateSubmitButtonState);

        function updateSubmitButtonState() {
            if (numpadMode !== 'create') return;

            const checkbox = document.getElementById('pin-acknowledge');
            const submitBtn = document.getElementById('numpad-submit-btn');

            if (checkbox.checked) {
                submitBtn.disabled = false;
                submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                submitBtn.classList.add('hover:bg-purple-700', 'active:scale-95');
            } else {
                submitBtn.disabled = true;
                submitBtn.classList.add('opacity-50', 'cursor-not-allowed');
                submitBtn.classList.remove('hover:bg-purple-700', 'active:scale-95');
            }
        }

        function closeNumpad() {
            const modal = document.getElementById('numpad-modal');
            document.getElementById('numpad-content').classList.replace('scale-100', 'scale-95');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
            currentPin = "";
        }

        function numpadInput(num) {
            if (currentPin.length < 6) {
                currentPin += num;
                playSound('input');
                updatePinDisplay();
            }
        }

        // --- REFERRAL SYSTEM LOGIC ---
        function showSection(section) {
            const forgeSec = document.getElementById('forge-section');
            const refSec = document.getElementById('referral-dashboard');
            const navForge = document.getElementById('nav-forge');
            const navRef = document.getElementById('nav-referrals');

            // Reset classes
            navForge.className = navForge.className.replace('bg-gray-900 text-white', 'text-gray-300 hover:text-white hover:bg-gray-700');
            navRef.className = navRef.className.replace('bg-gray-900 text-white', 'text-gray-300 hover:text-white hover:bg-gray-700');

            if (section === 'forge') {
                forgeSec.classList.remove('hidden');
                refSec.classList.add('hidden');
                navForge.classList.add('bg-gray-900', 'text-white');
                navForge.classList.remove('text-gray-300', 'hover:text-white', 'hover:bg-gray-700');
            } else {
                forgeSec.classList.add('hidden');
                refSec.classList.remove('hidden');
                navRef.classList.add('bg-gray-900', 'text-white');
                navRef.classList.remove('text-gray-300', 'hover:text-white', 'hover:bg-gray-700');
            }
        }

        async function openReferralDashboard() {
            showSection('referrals');
            if (!currentUser) return; // Should allow guest? No, needs ID.

            const loading = document.getElementById('referral-loading');
            const createDiv = document.getElementById('referral-create');
            const statsDiv = document.getElementById('referral-stats');

            loading.classList.remove('hidden');
            createDiv.classList.add('hidden');
            statsDiv.classList.add('hidden');

            try {
                const res = await fetch(`/api/referral/stats?user_id=${currentUser}`);
                if (res.status === 404) {
                    loading.classList.add('hidden');
                    createDiv.classList.remove('hidden');
                } else if (res.ok) {
                    const data = await res.json();
                    document.getElementById('my-ref-code').innerText = data.code;
                    document.getElementById('ref-usage').innerText = data.usage_count;
                    document.getElementById('ref-total').innerText = data.total_earnings.toFixed(3) + ' SOL';
                    document.getElementById('ref-balance').innerText = data.balance_sol.toFixed(3) + ' SOL';

                    loading.classList.add('hidden');
                    statsDiv.classList.remove('hidden');
                } else {
                    alert("Error loading stats");
                }
            } catch (e) {
                console.error(e);
                loading.innerText = "Error";
            }
        }

        async function createReferralCode(pin) {
            try {
                const res = await fetch('/api/referral/create', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ user_id: currentUser, pin: pin })
                });
                const data = await res.json();
                if (res.ok) {
                    alert("Code Created! " + data.code);
                    openReferralDashboard(); // Refresh
                } else {
                    alert("Error: " + data.error);
                }
            } catch (e) {
                console.error(e);
                alert("Creation failed.");
            }
        }

        async function initiateWithdrawal() {
             const amount = parseFloat(document.getElementById('withdraw-amount').value);
             const wallet = document.getElementById('withdraw-wallet').value;
             if (!amount || amount < 0.1) {
                 alert("Minimum withdrawal is 0.1 SOL");
                 return;
             }
             if (!wallet) {
                 alert("Please enter a wallet address");
                 return;
             }
             openNumpad('withdraw_referral', 'Enter PIN to Withdraw', submitWithdrawal);
        }

        async function submitWithdrawal(pin) {
             const amount = document.getElementById('withdraw-amount').value;
             const wallet = document.getElementById('withdraw-wallet').value;
             try {
                const res = await fetch('/api/referral/withdraw', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        user_id: currentUser,
                        pin: pin,
                        amount: amount,
                        target_wallet: wallet
                    })
                });
                const data = await res.json();
                if (res.ok) {
                    alert("Withdrawal Requested! Admin will process it shortly.");
                    openReferralDashboard(); // Refresh
                    document.getElementById('withdraw-amount').value = '';
                } else {
                    alert("Error: " + data.error);
                }
            } catch (e) {
                console.error(e);
                alert("Withdrawal failed.");
            }
        }

        async function checkReferralCode() {
            const code = document.getElementById('referral-code-input').value.toUpperCase();
            const msg = document.getElementById('referral-status-msg');
            if (!code) return;

            try {
                const res = await fetch('/api/referral/validate', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ code: code })
                });
                const data = await res.json();
                if (data.valid) {
                    referralDiscountActive = true;
                    msg.innerText = "Code Applied! 10% Discount Active.";
                    msg.className = "text-xs mt-1 text-green-400 font-bold";
                    msg.classList.remove('hidden');
                } else {
                    referralDiscountActive = false;
                    msg.innerText = "Invalid Code.";
                    msg.className = "text-xs mt-1 text-red-400";
                    msg.classList.remove('hidden');
                }
                updateEstimates();
            } catch(e) { console.error(e); }
        }

        function numpadClear() {
            if (currentPin.length > 0) {
                currentPin = currentPin.slice(0, -1);
                playSound('delete');
                updatePinDisplay();
            }
        }

        function updatePinDisplay() {
            const container = document.getElementById('pin-display');
            container.innerHTML = '';
            // Always show 6 slots
            for (let i = 0; i < 6; i++) {
                const dot = document.createElement('div');
                dot.className = `pin-dot ${i < currentPin.length ? 'active' : ''}`;
                container.appendChild(dot);
            }
        }

        async function numpadSubmit() {
            if (currentPin.length < 4) {
                alert("PIN must be at least 4 digits.");
                return;
            }
            playSound('input'); // Confirm sound?
            if (numpadMode === 'create') {
                await setPin(currentPin);
            } else if (numpadMode === 'submit') {
                numpadCallback(currentPin);
            } else if (numpadMode === 'reveal') {
                numpadCallback(revealJobId, currentPin);
            } else if (numpadMode === 'create_referral') {
                numpadCallback(currentPin);
            } else if (numpadMode === 'withdraw_referral') {
                numpadCallback(currentPin);
            }

            closeNumpad();
        }

        // AUTHENTICATION
        async function loginWithGoogle() {
            isExplicitLogin = true;
            const provider = new firebase.auth.GoogleAuthProvider();
            try {
                const result = await firebase.auth().signInWithPopup(provider);
                const user = result.user;
                const token = await user.getIdToken();
                currentUser = user.uid;
                window.walletAddress = user.uid; // Satisfy guard check
                currentUserEmail = user.email;
                await checkUserStatus(currentUser, token);
            } catch (error) {
                console.error("Popup error:", error);
                alert("Google Login Failed: " + error.message);
            }
        }

        async function connectWallet(silent = false) {
            if (window.solana && window.solana.isPhantom) {
                // 🔒 FIX: Aggressive disconnect to force popup
                if (!silent && window.solana.isConnected) {
                    await window.solana.disconnect();
                    await new Promise(r => setTimeout(r, 400)); // Delay is crucial
                }

                if (!silent) {
                    isExplicitLogin = true;
                    // Now connect actively (forces popup)
                    try {
                        const resp = await window.solana.connect();
                        currentUser = resp.publicKey.toString();
                        window.walletAddress = currentUser;
                        window.currentWallet = currentUser; // Fix SNS
                        await checkUserStatus(currentUser);
                    } catch (err) {
                        console.error(err);
                        alert("Connection failed.");
                    }
                } else {
                    // Silent auto-connect (only on load)
                    try {
                        const resp = await window.solana.connect({ onlyIfTrusted: true });
                        currentUser = resp.publicKey.toString();
                        window.walletAddress = currentUser;
                        window.currentWallet = currentUser; // Fix SNS
                        await checkUserStatus(currentUser);
                    } catch (e) {
                        // Silent fail - User stays as Guest
                    }
                }
            } else {
                if (!silent) window.open("https://phantom.app/", "_blank");
            }
        }

        window.addEventListener('load', () => {
            // Check for Referral Link
            const urlParams = new URLSearchParams(window.location.search);
            const refCode = urlParams.get('ref');
            if (refCode) {
                const input = document.getElementById('referral-code-input');
                if (input) {
                    input.value = refCode.toUpperCase();
                    // Auto-validate after a short delay to ensure UI is ready
                    setTimeout(() => checkReferralCode(), 500);
                }
            }

            if (window.solana && window.solana.isPhantom) {
                connectWallet(true);
            }
        });

        async function checkUserStatus(userId, idToken = null) {
            if (!userId) return;
            try {
                const body = { user_id: userId };
                if (idToken) body.id_token = idToken;

                // Fallback to email if no token (legacy/unsafe but kept for compat)
                if (currentUserEmail) body.email = currentUserEmail;

                const res = await fetch('/check-user', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(body)
                });
                const data = await res.json();
                userTrialsUsed = data.trials_used || 0;

                // Lifetime Binding Check
                if (data.referred_by) {
                    const refInput = document.getElementById('referral-code-input');
                    refInput.value = data.referred_by;
                    refInput.disabled = true;

                    const msg = document.getElementById('referral-status-msg');
                    msg.innerText = "Lifetime Discount Active (Bound to " + data.referred_by + ")";
                    msg.className = "text-xs mt-1 text-purple-400 font-bold";
                    msg.classList.remove('hidden');

                    referralDiscountActive = true;
                }

                if (data.has_pin) {
                    onLoginSuccess();
                } else {
                    // 🔒 FIX: Stop here if this wasn't an explicit user action
                    if (
                        isExplicitLogin === true &&
                        window.walletAddress &&
                        typeof window.walletAddress === "string"
                    ) {
                        // Prompt to create PIN
                        document.getElementById('auth-section').classList.add('hidden');
                        // Hide auth temporarily
                        openNumpad('create', 'Create your Vault PIN', null);
                    }
                }
            } catch (e) {
                console.error(e);
                alert("Error checking user status.");
            }
        }

        async function setPin(pin) {
            try {
                const res = await fetch('/set-pin', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ user_id: currentUser, pin: pin })
                });
                if (res.ok) {
                    onLoginSuccess();
                } else {
                    alert("Failed to set PIN.");
                    location.reload();
                }
            } catch (e) {
                console.error(e);
                alert("Error setting PIN.");
            }
        }

        function closeBetaModal() {
            const modal = document.getElementById('beta-modal');
            document.getElementById('beta-modal-content').classList.replace('scale-100', 'scale-95');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        function onLoginSuccess(isDev = false) {
            document.getElementById('auth-section').classList.add('hidden');
            const appInterface = document.getElementById('app-interface');
            appInterface.classList.remove('hidden');
            document.getElementById('job-queue-section').classList.remove('hidden');

            // God Mode Check
            if (ADMIN_EMAILS.includes(currentUserEmail)) {
                const titleSpan = document.querySelector('nav .text-purple-500');
                if (titleSpan) {
                    titleSpan.innerHTML = '<i class="fa-solid fa-fire-flame-curved"></i> Welcome Dev 🛠️';
                }
                const godModeBadge = document.createElement('span');
                godModeBadge.className = "ml-4 bg-yellow-500/20 text-yellow-400 text-xs font-bold px-2 py-1 rounded border border-yellow-500/50 animate-pulse";
                godModeBadge.innerText = "God Mode Active";
                titleSpan.appendChild(godModeBadge);
            }

            // Show Beta Modal
            const betaModal = document.getElementById('beta-modal');
            betaModal.classList.remove('hidden');
             setTimeout(() => {
                document.getElementById('beta-modal-content').classList.replace('scale-95', 'scale-100');
            }, 10);
            // Simple fade in effect
            appInterface.style.opacity = 0;
            setTimeout(() => {
                appInterface.style.transition = 'opacity 0.5s ease-in-out';
                appInterface.style.opacity = 1;
            }, 50);
            let displayId = currentUser;
            if (currentUser === "DEV_USER") displayId = "Dev Mode";
            else if (currentUser.length > 10) displayId = currentUser.slice(0, 4) + '...' + currentUser.slice(-4);

            document.getElementById('user-id-display').innerText = displayId;
            // Default Check email notify if logged in via Google (and thus have email)
            if (currentUserEmail) {
                document.getElementById('email-notify').checked = true;
            }

            pollJobStatus();
        }

        // CALCULATIONS (Helpers)
        function escapeHtml(text) {
            if (!text) return text;
            return text.replace(/[&<>"']/g, function(m) { return {'&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;'}[m]; });
        }

        function updateEstimates() {
            const p = document.getElementById('prefix').value || "";
            const s = document.getElementById('suffix').value || "";
            const totalLen = p.length + s.length;

            // use-gpu is always true now
            const useGpuCheckbox = document.getElementById('use-gpu');
            if (useGpuCheckbox) useGpuCheckbox.checked = true;

            if (totalLen === 0) {
                document.getElementById('calc-difficulty').innerText = "0 chars";
                document.getElementById('calc-time').innerText = "Instant";
                document.getElementById('calc-cost').innerText = "0 SOL";
                return;
            }

            // Fixed Pricing Logic
            let basePrice = 0;
            if (totalLen <= 4) basePrice = 0.25;
            else if (totalLen === 5) basePrice = 0.50;
            else if (totalLen === 6) basePrice = 1.00;
            else if (totalLen === 7) basePrice = 2.00;
            else if (totalLen === 8) basePrice = 3.00;
            else basePrice = 5.00;

            // No GPU Surcharge anymore - everyone gets GPU

            // Apply 50% Discount (on the final price)
            let finalPrice = basePrice * 0.5;

            // Apply Referral Discount (Extra 10%)
            if (referralDiscountActive) {
                finalPrice = finalPrice * 0.90;
            }

            // Check Trial (Only if NOT using GPU, or maybe trial allows GPU? Assuming trial is basic only usually, but let's assume trial covers cost)
            // If user selects GPU, maybe trial doesn't apply? User requirement: "50% Beta Discount Applied".
            // Let's assume Trial is valid for price 0, regardless of GPU selection if Length <= 4.
            // But if they select GPU for length 4, does it cost money? "If selected, increase the calculated price by 50%."
            // If trial makes it free, 0 * 1.5 = 0.

            let isTrial = false;
            if (totalLen <= 4 && userTrialsUsed < 2) {
                isTrial = true;
                finalPrice = 0;
            }

            // Time Estimate Logic
            // New Formula: (Difficulty / 300,000,000) + 600
            // Difficulty = 0.5 * 58^TotalLength
            // 600s buffer for cloud provisioning

            let difficulty = 0.5 * Math.pow(58, totalLen);
            let speed = 300000000; // 300 MH/s
            let buffer = 600; // 10 minutes

            let seconds = (difficulty / speed) + buffer;

            let timeStr;
            // Always show minutes if < hour, else hours/days
            // Since min is 600s (10m), we start at 10m
            if (seconds < 3600) timeStr = Math.ceil(seconds/60) + "m";
            else if (seconds < 86400) timeStr = (seconds/3600).toFixed(1) + "h";
            else timeStr = (seconds/86400).toFixed(1) + "d";

            document.getElementById('calc-difficulty').innerText = totalLen + " chars";
            document.getElementById('calc-time').innerText = "~" + timeStr;

            const costEl = document.getElementById('calc-cost');
            if (isTrial) {
                 // Trial UI: <del>0.25 SOL</del> FREE (Trial)
                 costEl.innerHTML = `<span style="text-decoration:line-through;" class="text-gray-500 mr-2">${basePrice.toFixed(2)} SOL</span> <span class="text-green-400">FREE (Trial)</span>`;
            } else {
                 // Discount UI: <del>1.0 SOL</del> 0.5 SOL
                 costEl.innerHTML = `<span style="text-decoration:line-through;" class="text-gray-500 mr-2">${basePrice.toFixed(2)} SOL</span> <span class="text-purple-400">${finalPrice.toFixed(2)} SOL</span>`;
            }

            // Hard Limit Warning - REMOVED for >5 because we now support it via GPU
            /*
            if (totalLen > 5 && !ADMIN_EMAILS.includes(currentUserEmail)) {
                // ...
            }
            */
           // Clear errors
           document.getElementById('submit-error').classList.add('hidden');
           document.querySelector('button[onclick="startSubmissionFlow()"]').disabled = false;
           document.querySelector('button[onclick="startSubmissionFlow()"]').classList.remove('opacity-50', 'cursor-not-allowed');
        }

        ['prefix', 'suffix'].forEach(id => {
            document.getElementById(id).addEventListener('input', (e) => {
                const val = e.target.value;
                const clean = val.replace(/[^1-9A-HJ-NP-Za-km-z]/g, '');
                if (val !== clean) e.target.value = clean;
                updateEstimates();
            });
        });

        const computeRadios = document.querySelectorAll('input[name="compute_method"]');
        const gpuWarning = document.getElementById('gpu-warning');
        // We target the Forge button. It calls startSubmissionFlow()
        // It's the button with that onclick handler.
        const forgeBtn = document.querySelector('button[onclick="startSubmissionFlow()"]');

        computeRadios.forEach(radio => {
          radio.addEventListener('change', (e) => {
            if (e.target.value === 'gpu') {
              gpuWarning.classList.remove('hidden');
              forgeBtn.disabled = true;
              forgeBtn.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
              gpuWarning.classList.add('hidden');
              forgeBtn.disabled = false;
              forgeBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
          });
        });

        // document.getElementById('use-gpu').addEventListener('change', updateEstimates);
        // EMAIL NOTIFICATION LOGIC
        document.getElementById('email-notify').addEventListener('change', async function(e) {
            if (this.checked && !currentUserEmail) {
                const provider = new firebase.auth.GoogleAuthProvider();
                try {
                    const result = await firebase.auth().signInWithPopup(provider);
                    const user = result.user;
                    currentUser = user.uid;
                    currentUserEmail = user.email;
                    await checkUserStatus(currentUser);
                } catch (error) {
                    console.error("Email login failed:", error);
                    this.checked = false;
                    alert("Email is required for notifications.");
                }
            }
        });

        // JOB SUBMISSION
        function startSubmissionFlow() {
             const prefix = document.getElementById('prefix').value;
             const suffix = document.getElementById('suffix').value;
             const totalLen = prefix.length + suffix.length;
             if (!prefix && !suffix) {
                const errorEl = document.getElementById('submit-error');
                errorEl.innerText = "Please specify a prefix or suffix.";
                errorEl.classList.remove('hidden');
                return;
             }
             document.getElementById('submit-error').classList.add('hidden');
             // Check estimated time
             // Time (seconds) = (0.5 * 58^TotalLength) / 5,000,000
             let seconds = (0.5 * Math.pow(58, totalLen)) / 5000000;
             if (seconds > 3600) {
                 let timeStr;
                 if (seconds < 86400) timeStr = (seconds/3600).toFixed(1) + " hours";
                 else timeStr = (seconds/86400).toFixed(1) + " days";
                 if (!confirm(`This job may take ${timeStr}. Do you accept the wait and proceed?`)) {
                     return;
                 }
             }

             openNumpad('submit', 'Enter PIN to Forge', submitJob);
        }

        async function submitJob(pin) {
            const prefix = document.getElementById('prefix').value;
            const suffix = document.getElementById('suffix').value;
            const caseSensitive = document.getElementById('case-sensitive').checked;
            const notify = document.getElementById('email-notify').checked;
            const useGpu = true; // Always true

            const errorEl = document.getElementById('submit-error');
            const submitBtn = document.querySelector('button[onclick="startSubmissionFlow()"]');
            // Disable button
            submitBtn.disabled = true;

            // God Mode Check
            const isGodMode = ADMIN_EMAILS.includes(currentUserEmail);
            // Calculate Price & Check Payment
            const totalLen = prefix.length + suffix.length;
            // Fixed Pricing Logic
            let basePrice = 0;
            if (totalLen <= 4) basePrice = 0.25;
            else if (totalLen === 5) basePrice = 0.50;
            else if (totalLen === 6) basePrice = 1.00;
            else if (totalLen === 7) basePrice = 2.00;
            else if (totalLen === 8) basePrice = 3.00;
            else basePrice = 5.00;

            // No GPU Surcharge
            submitBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Initializing RedPanda Engine...';

            // Apply 50% Discount
            let cost = basePrice * 0.5;
            let isTrial = (totalLen <= 4 && userTrialsUsed < 2);
            let transactionSignature = null;
            // If trial, cost is 0
            if (isTrial) cost = 0;
            // God Mode Skips Payment
            if (!isGodMode && cost > 0) {
                 if (!window.solana || !window.solana.isConnected) {
                     if (window.solana) {
                         try {
                             await window.solana.connect();
                         } catch (err) {
                             submitBtn.disabled = false;
                             submitBtn.innerHTML = '<i class="fa-solid fa-rocket"></i> Forge';
                             alert("Wallet required for payment");
                             return;
                         }
                     } else {
                         submitBtn.disabled = false;
                         submitBtn.innerHTML = '<i class="fa-solid fa-rocket"></i> Forge';
                         alert("Phantom Wallet is required for payment.");
                         return;
                     }
                 }

                 try {

                     // 2. Build Transaction
                     const TREASURY_PUBKEY = new solanaWeb3.PublicKey(TREASURY_WALLET_ADDRESS);
                     const fromPubkey = window.solana.publicKey;

                     const transaction = new solanaWeb3.Transaction().add(
                         solanaWeb3.SystemProgram.transfer({
                             fromPubkey: fromPubkey,
                             toPubkey: TREASURY_PUBKEY,
                             lamports: Math.round(cost * solanaWeb3.LAMPORTS_PER_SOL)
                         })
                     );
                     transaction.feePayer = fromPubkey;
                     // Use the dedicated Helius endpoint
                     // The user will replace the placeholder with their actual URL
                     // UPDATED WITH USER KEY
                     const connection = new solanaWeb3.Connection(window.location.origin + "/api/rpc", "confirmed");
                     const { blockhash, lastValidBlockHeight } = await connection.getLatestBlockhash();
                     transaction.recentBlockhash = blockhash;
                     // 3. Sign and Send
                     const { signature } = await window.solana.signAndSendTransaction(transaction);
                     transactionSignature = signature;

                     // 4. Wait for Confirmation
                     submitBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Confirming Payment...';
                     await connection.confirmTransaction({
                         signature: signature,
                         blockhash: blockhash,
                         lastValidBlockHeight: lastValidBlockHeight
                     });

                 } catch (err) {
                     console.error(err);
                     submitBtn.disabled = false;
                     submitBtn.innerHTML = '<i class="fa-solid fa-rocket"></i> Forge';
                     errorEl.innerText = "Payment failed: " + err.message;
                     errorEl.classList.remove('hidden');
                     return;
                 }
            }

            const payload = {
                user_id: currentUser,
                prefix: prefix,
                suffix: suffix,
                case_sensitive: caseSensitive,
                pin: pin,
                transaction_signature: transactionSignature,
                email: currentUserEmail,
                notify: notify,
                use_gpu: useGpu,
                referral_code: document.getElementById('referral-code-input').value
            };
            try {
                const res = await fetch('/submit-job', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (res.ok) {
                    // Update trials locally for immediate feedback
                    if (isTrial) userTrialsUsed++;
                    // Success feedback
                    document.getElementById('prefix').value = '';
                    document.getElementById('suffix').value = '';
                    updateEstimates();
                } else {
                    const data = await res.json().catch(() => ({}));
                    throw new Error(data.message || data.error || "Submission failed.");
                }
            } catch (e) {
                errorEl.innerText = e.message;
                errorEl.classList.remove('hidden');
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fa-solid fa-rocket"></i> Forge';
            }
        }

        // POLLING & UI
        function pollJobStatus() {
            if (jobListenerUnsubscribe) jobListenerUnsubscribe();
            const container = document.getElementById('jobs-container');
            const emptyState = document.getElementById('jobs-empty-state');

            jobListenerUnsubscribe = db.collection('vanity_jobs')
                .where('user_id', '==', currentUser)
                .orderBy('created_at', 'desc')
                .onSnapshot((snapshot) => {
                    if (snapshot.empty) {
                        container.innerHTML = '';
                        emptyState.classList.remove('hidden');
                        return;
                    }
                    emptyState.classList.add('hidden');

                    const fragment = document.createDocumentFragment();

                    snapshot.forEach(doc => {
                        const job = doc.data();
                        const status = (job.status || "").toUpperCase();

                        // Check if key is available
                        const secretKey = job.secret_key; // Encrypted

                        let statusColor = 'text-gray-400';
                        let statusIcon = '';
                        let resultHtml = '';

                        if (status === 'COMPLETED') {
                            statusColor = 'text-green-400';
                            statusIcon = '<i class="fa-solid fa-check-circle"></i>';

                            // Show Eye Icon and Copy Button
                            resultHtml = `
                                <div class="mt-2 bg-gray-900/50 p-2 rounded border border-gray-700/50">
                                    <div class="flex justify-between items-center mb-1">
                                        <span class="text-[10px] text-gray-500 uppercase font-bold tracking-wider">Public Key</span>
                                        <button onclick="copyToClipboard('${job.public_key}')" class="text-xs text-purple-400 hover:text-purple-300 transition-colors" title="Copy Public Key"><i class="fa-regular fa-copy"></i></button>
                                    </div>
                                    <div class="font-mono text-[10px] break-all text-gray-300 mb-2 bg-black/20 p-1 rounded">${job.public_key}</div>

                                    <div class="flex justify-between items-center mb-1">
                                        <span class="text-[10px] text-gray-500 uppercase font-bold tracking-wider">Private Key</span>
                                        <button onclick="openNumpad('reveal', 'Enter PIN to Unlock', revealKey, '${doc.id}')" id="btn-${doc.id}" class="text-xs text-purple-400 hover:text-purple-300 transition-colors uppercase font-bold" title="Reveal Private Key"><i class="fa-regular fa-eye"></i></button>
                                    </div>
                                    <div id="secret-${doc.id}" class="hidden flex items-start gap-2 animate-fade-in">
                                        <div id="key-text-${doc.id}" class="font-mono text-[10px] break-all text-red-300 bg-red-900/10 p-1 rounded border border-red-900/20 flex-grow">
                                            </div>
                                        <button onclick="copyKey('${doc.id}')" class="text-gray-400 hover:text-white pt-1 transition-colors" title="Copy Private Key"><i class="fa-regular fa-copy"></i></button>
                                    </div>
                                </div>
                            `;
                        } else if (status === 'FAILED') {
                            statusColor = 'text-red-400';
                            statusIcon = '<i class="fa-solid fa-times-circle"></i>';
                            resultHtml = `
                                <div class="mt-1 text-[10px] text-red-400 italic">
                                    ${escapeHtml(job.error || "Job failed.")}
                                </div>
                            `;
                        } else {
                            statusColor = 'text-yellow-400';
                            statusIcon = '<i class="fa-regular fa-clock animate-spin"></i>';
                        }

                        const tr = document.createElement('tr');
                        tr.className = "hover:bg-gray-800/50 transition-colors align-top";
                        tr.innerHTML = `
                            <td class="py-3 pr-2 border-b border-gray-800">
                                <div class="font-bold text-gray-200 font-mono text-sm break-all mb-1">
                                    ${job.prefix || '...'}-${job.suffix || '...'}
                                </div>
                                <div class="flex flex-wrap items-center gap-2">
                                     <span class="text-[10px] text-gray-500 font-mono">#${doc.id.slice(0, 8)}</span>
                                     ${job.case_sensitive ? '<span class="text-[10px] text-purple-400 border border-purple-500/30 bg-purple-500/10 px-1 rounded" title="Case Sensitive">Case</span>' : ''}
                                </div>
                            </td>
                            <td class="py-3 pr-2 border-b border-gray-800">
                                <span class="text-xs font-bold ${statusColor} capitalize flex items-center gap-1">
                                    ${statusIcon} ${job.status}
                                </span>
                            </td>
                            <td class="py-3 border-b border-gray-800">
                                ${resultHtml}
                            </td>
                        `;
                        fragment.appendChild(tr);
                    });

                    container.innerHTML = '';
                    container.appendChild(fragment);

                }, (error) => {
                    console.error("Error polling jobs:", error);
                    emptyState.innerText = 'Error connecting to job server.';
                    emptyState.classList.remove('hidden');
                });
        }

        function logout() {
            if (jobListenerUnsubscribe) jobListenerUnsubscribe();
            firebase.auth().signOut().then(() => {
                currentUser = null;
                currentUserEmail = null;
                document.getElementById('app-interface').classList.add('hidden');
                document.getElementById('job-queue-section').classList.add('hidden');
                document.getElementById('auth-section').classList.remove('hidden');
                // Hide mobile menu if open
                const mobileMenu = document.getElementById('mobile-menu');
                if (mobileMenu && !mobileMenu.classList.contains('hidden')) {
                    mobileMenu.classList.add('hidden');
                }
                const titleSpan = document.querySelector('nav .text-purple-500');
                if (titleSpan) titleSpan.innerHTML = '<i class="fa-solid fa-fire-flame-curved"></i> VanityForge';
            }).catch((error) => {
                console.error("Sign Out Error", error);
            });
        }

        async function revealKey(jobId, pin) {
            try {
                const res = await fetch('/reveal-key', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ job_id: jobId, pin: pin })
                });
                const data = await res.json();

                if (res.ok) {
                    const el = document.getElementById(`secret-${jobId}`);
                    const btn = document.getElementById(`btn-${jobId}`);
                    const keyText = document.getElementById(`key-text-${jobId}`);

                    keyText.innerText = data.secret_key;
                    el.classList.remove('hidden');
                    btn.innerHTML = '<i class="fa-regular fa-eye-slash"></i>';
                    btn.onclick = () => {
                         el.classList.add('hidden');
                         btn.innerHTML = '<i class="fa-regular fa-eye"></i>';
                         keyText.innerText = '';
                         // Reset onclick
                         btn.onclick = () => openNumpad('reveal', 'Enter PIN to Unlock', revealKey, jobId);
                    };
                } else {
                    alert(data.error || "Failed to reveal key.");
                }
            } catch (e) {
                console.error(e);
                alert("Error revealing key.");
            }
        }

        function copyKey(id) {
            const text = document.getElementById(`key-text-${id}`).innerText;
            copyToClipboard(text);
        }

        function copyReferralCode() {
            const code = document.getElementById('my-ref-code').innerText;
            copyToClipboard(code);
        }

        function copyReferralLink() {
            const code = document.getElementById('my-ref-code').innerText;
            const link = window.location.origin + "/?ref=" + code;
            copyToClipboard(link);
        }

        function copyToClipboard(text) {
            if (!text || text === '----') return;
            // Visual Feedback Function
            const showFeedback = () => {
                const activeEl = document.activeElement;
                if(activeEl && (activeEl.tagName === 'BUTTON' || activeEl.closest('button'))) {
                    const btn = activeEl.tagName === 'BUTTON' ? activeEl : activeEl.closest('button');
                    const icon = btn.querySelector('i');
                    if(icon) {
                        const originalClass = icon.className;
                        // Determine correct icon based on button type
                        const isLinkBtn = btn.innerText.includes("Link");

                        icon.className = "fa-solid fa-check text-green-400";

                        // Tooltip logic
                        let tooltip = document.createElement("span");
                        tooltip.className = "absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-900 text-white text-xs px-2 py-1 rounded shadow-lg animate-fade-in-up z-50 border border-gray-700 whitespace-nowrap";
                        tooltip.innerText = "Copied!";
                        btn.style.position = "relative";
                        btn.appendChild(tooltip);

                        setTimeout(() => {
                            // Restore icon
                            if (isLinkBtn) icon.className = "fa-solid fa-link";
                            else icon.className = "fa-regular fa-copy";

                            if(tooltip) tooltip.remove();
                        }, 2000);
                    }
                }
            };
            if (navigator.clipboard && window.isSecureContext) {
                // Secure context (HTTPS)
                navigator.clipboard.writeText(text).then(showFeedback).catch(err => {
                    console.error('Failed to copy via Clipboard API: ', err);
                    fallbackCopy(text, showFeedback);
                });
            } else {
                // Non-secure context (HTTP)
                fallbackCopy(text, showFeedback);
            }
        }

        function fallbackCopy(text, successCallback) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed";
            textArea.style.left = "-9999px";
            textArea.style.top = "0";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    successCallback();
                } else {
                    prompt("Copy to clipboard: Ctrl+C, Enter", text);
                }
            } catch (err) {
                console.error('Fallback copy failed', err);
                prompt("Copy to clipboard: Ctrl+C, Enter", text);
            }

            document.body.removeChild(textArea);
        }

        // Global assignments
        window.loginWithGoogle = loginWithGoogle;
        window.connectWallet = connectWallet;
        window.startSubmissionFlow = startSubmissionFlow;
        window.submitJob = submitJob;
        window.revealKey = revealKey;
        window.copyToClipboard = copyToClipboard;
        window.copyKey = copyKey;
        window.numpadInput = numpadInput;
        window.numpadClear = numpadClear;
        window.numpadSubmit = numpadSubmit;
        window.closeNumpad = closeNumpad;

        // Security Modal
        function openSecurityModal() {
            const modal = document.getElementById('security-modal');
            modal.classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('security-modal-content').classList.replace('scale-95', 'scale-100');
            }, 10);
        }

        function closeSecurityModal() {
             const modal = document.getElementById('security-modal');
             document.getElementById('security-modal-content').classList.replace('scale-100', 'scale-95');
             setTimeout(() => {
                 modal.classList.add('hidden');
             }, 300);
        }
    </script>
    <script src="vanity.js"></script>
</body>
</html>
